ORG 0x0
V0: WORD $DEFAULT, 0x180
V1: WORD $CALL_PRINT, 0x180
V2: WORD $DEFAULT, 0x180
V3: WORD $DEFAULT, 0x180
V4: WORD $DEFAULT, 0x180
V5: WORD $DEFAULT, 0x180
V6: WORD $DEFAULT, 0x180
V7: WORD $DEFAULT, 0x180
DEFAULT: IRET

TIME: WORD 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0
PREV_TIME: WORD 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0
SUBANS: WORD 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0

CUR_TIME_START: WORD $TIME
PREV_CUR_TIME_START: WORD $PREV_TIME
SUB_START: WORD $SUBANS

XP_IP: WORD 0x0
NP: WORD 0x0

CUR_TIME_POS: WORD 0x0
CUR_TIME_POS2: WORD 0x0
PREV_TIME_POS: WORD 0x0
SUB_TIME_POS: WORD 0x0

LOOP_COUNTER: WORD 0x0
NUMBER_LENGTH: WORD 0x8

CALL_PRINT:
PUSHF
DI
IN 0x4

LD CUR_TIME_START
PUSH
CALL MINUS

LD CUR_TIME_START
PUSH
CALL PRINT_NUMBER

LD PREV_TIME_POS
PUSH
CALL PRINT_NUMBER

LD SUB_TIME_POS
PUSH
CALL PRINT_NUMBER


POPF
IRET



START: CLA
OUT 1
OUT 3
OUT 5
OUT 7

;LD #0x8 ;1000 -> 
; OUT 0x1
LD #0x9 ;1001 -> 
OUT 0x5

EI
MAIN_LOOP: 
JUMP MAIN_LOOP

PRINT_NUMBER: LD NUMBER_LENGTH
ST NP
LD &0x1
ADD NUMBER_LENGTH
ST XP_IP
PRINT_LOOP:
LD  -(XP_IP)
ADD #0x30
CALL PRINT_LETTER
LOOP NP
JUMP PRINT_LOOP
SWAP
ST &0x1
POP		;2xSWAP
RET

PRINT_LETTER:
PUSH
S1: IN 0xD
AND #0x40
BEQ S1
POP
OUT 0xC
RET


MINUS:

LD &0x1
ST CUR_TIME_POS
ADD NUMBER_LENGTH
ST PREV_TIME_POS
ADD NUMBER_LENGTH
ST SUB_TIME_POS

LD NUMBER_LENGTH
ST LOOP_COUNTER
CLC
LOOPP_MINUS:
LD (CUR_TIME_POS)+
BCC CONT
DEC
CONT: 
SUB (PREV_TIME_POS)
CLC
BPL CHANGE_MN				  ;<0
SUB #0x6
CLC
CMC
CHANGE_MN: 
AND #0xF
ST (SUB_TIME_POS)+
LOOP LOOP_COUNTER
JUMP LOOPP_MINUS

SWAP
ST &0x1
POP  ;2xSWAP
RET
